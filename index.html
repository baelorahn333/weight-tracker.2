<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <meta name="theme-color" content="#0a0a0a" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="apple-mobile-web-app-title" content="ì²´ì¤‘ê¸°ë¡" />
  <meta name="description" content="ì²´ì¤‘ì„ ê¸°ë¡í•˜ê³  ë³€í™”ë¥¼ ì¶”ì í•˜ì„¸ìš”" />
  <link rel="manifest" href="manifest.json" />
  <link rel="apple-touch-icon" href="icons/icon-192.png" />
  <title>ì²´ì¤‘ê¸°ë¡</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=DM+Mono:wght@300;400;500&display=swap');

    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --bg: #0a0a0a;
      --bg2: #111111;
      --border: #1e1e1e;
      --border2: #252525;
      --text: #e8e8e8;
      --muted: #555555;
      --dim: #333333;
      --accent: #7fff7f;
      --danger: #ff7f7f;
      --font: 'DM Mono', 'Fira Mono', monospace;
    }

    html, body {
      height: 100%;
      background: var(--bg);
      color: var(--text);
      font-family: var(--font);
      -webkit-font-smoothing: antialiased;
      overscroll-behavior: none;
    }

    body {
      padding-bottom: env(safe-area-inset-bottom);
    }

    /* â”€â”€ Header â”€â”€ */
    .header {
      position: sticky;
      top: 0;
      z-index: 50;
      background: rgba(10,10,10,0.92);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      border-bottom: 1px solid var(--border);
      padding: 16px 20px 14px;
      padding-top: calc(16px + env(safe-area-inset-top));
    }
    .header-label { font-size: 11px; letter-spacing: 0.2em; color: var(--muted); text-transform: uppercase; margin-bottom: 2px; }
    .header-title { font-size: 22px; letter-spacing: -0.02em; }
    .header-title span { color: var(--accent); }

    /* â”€â”€ Tabs â”€â”€ */
    .tabs {
      display: flex;
      gap: 0;
      border-bottom: 1px solid var(--border);
      background: var(--bg);
      position: sticky;
      top: calc(68px + env(safe-area-inset-top));
      z-index: 40;
    }
    .tab-btn {
      flex: 1;
      background: none;
      border: none;
      color: var(--muted);
      font-family: var(--font);
      font-size: 11px;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      padding: 14px 0;
      cursor: pointer;
      border-bottom: 2px solid transparent;
      transition: color 0.15s, border-color 0.15s;
    }
    .tab-btn.active { color: var(--accent); border-bottom-color: var(--accent); }

    /* â”€â”€ Sections â”€â”€ */
    .page { display: none; padding: 20px 20px 40px; max-width: 640px; margin: 0 auto; }
    .page.active { display: block; }

    .section { margin-top: 28px; }
    .section:first-child { margin-top: 0; }
    .section-label { font-size: 11px; letter-spacing: 0.15em; color: var(--dim); text-transform: uppercase; margin-bottom: 12px; }

    /* â”€â”€ Stats â”€â”€ */
    .stats-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px; }
    .stat-card { background: var(--bg2); border: 1px solid var(--border); border-radius: 10px; padding: 14px; }
    .stat-lbl { font-size: 10px; color: var(--muted); letter-spacing: 0.1em; text-transform: uppercase; margin-bottom: 6px; }
    .stat-val { font-size: 26px; letter-spacing: -0.03em; }
    .stat-unit { font-size: 12px; color: var(--muted); margin-left: 2px; }
    .green { color: var(--accent); }
    .red { color: var(--danger); }
    .gray { color: var(--muted); }

    /* â”€â”€ Chart â”€â”€ */
    .chart-wrap { background: var(--bg2); border: 1px solid var(--border); border-radius: 10px; padding: 14px 8px 8px; overflow: hidden; position: relative; }
    .chart-empty { text-align: center; color: var(--dim); font-size: 12px; padding: 40px 0; letter-spacing: 0.05em; }
    svg.chart { width: 100%; display: block; }
    .tooltip-box { position: absolute; background: #1e1e1e; border: 1px solid #2e2e2e; border-radius: 6px; padding: 8px 12px; font-size: 11px; pointer-events: none; z-index: 10; display: none; }
    .tooltip-date { color: var(--muted); margin-bottom: 3px; }
    .tooltip-weight { color: var(--accent); font-size: 16px; }

    /* â”€â”€ Form â”€â”€ */
    .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 10px; }
    .form-group { display: flex; flex-direction: column; gap: 6px; }
    .form-label { font-size: 11px; color: var(--muted); letter-spacing: 0.1em; text-transform: uppercase; }
    input[type="date"], input[type="number"], input[type="text"] {
      background: var(--bg2);
      border: 1px solid var(--border2);
      border-radius: 8px;
      padding: 11px 13px;
      color: var(--text);
      font-size: 15px;
      font-family: var(--font);
      outline: none;
      width: 100%;
      transition: border-color 0.15s;
      -webkit-appearance: none;
    }
    input:focus { border-color: var(--accent); }
    input[type="date"]::-webkit-calendar-picker-indicator { filter: invert(0.4); cursor: pointer; }
    .note-input { background: var(--bg2); border: 1px solid var(--border2); border-radius: 8px; padding: 11px 13px; color: var(--text); font-size: 14px; font-family: var(--font); outline: none; width: 100%; margin-bottom: 12px; transition: border-color 0.15s; }
    .note-input:focus { border-color: var(--accent); }
    .add-btn {
      width: 100%; background: var(--accent); color: #0a0a0a;
      border: none; border-radius: 8px; padding: 14px;
      font-size: 14px; font-family: var(--font); letter-spacing: 0.08em;
      cursor: pointer; font-weight: 600; transition: opacity 0.15s;
      -webkit-tap-highlight-color: transparent;
    }
    .add-btn:active { opacity: 0.8; }

    /* â”€â”€ History â”€â”€ */
    .history-item {
      display: flex; align-items: center; justify-content: space-between;
      padding: 14px 0; border-bottom: 1px solid #181818;
    }
    .hist-date { font-size: 11px; color: var(--muted); margin-bottom: 4px; }
    .hist-weight { font-size: 20px; letter-spacing: -0.02em; }
    .hist-unit { font-size: 12px; color: var(--dim); }
    .hist-delta { font-size: 12px; margin-left: 6px; }
    .hist-note { font-size: 11px; color: #383838; margin-top: 3px; }
    .del-btn {
      background: none; border: 1px solid #222; border-radius: 6px;
      color: var(--dim); font-size: 11px; padding: 6px 12px; cursor: pointer;
      font-family: var(--font); letter-spacing: 0.05em; transition: all 0.15s;
      white-space: nowrap; -webkit-tap-highlight-color: transparent;
    }
    .del-confirm { color: var(--danger); border-color: #3a1a1a; }
    .cancel-btn { color: var(--dim); border-color: #222; }
    .del-actions { display: flex; gap: 6px; }
    .empty-state { text-align: center; color: var(--dim); font-size: 13px; padding: 48px 0; letter-spacing: 0.04em; line-height: 2; }

    /* â”€â”€ Toast â”€â”€ */
    .toast {
      position: fixed; bottom: calc(24px + env(safe-area-inset-bottom));
      left: 50%; transform: translateX(-50%) translateY(10px);
      background: #1a1a1a; border: 1px solid #2a2a2a;
      border-radius: 8px; padding: 12px 22px;
      font-size: 13px; letter-spacing: 0.04em;
      box-shadow: 0 8px 32px rgba(0,0,0,0.5);
      z-index: 999; opacity: 0; transition: all 0.2s;
      white-space: nowrap;
    }
    .toast.show { opacity: 1; transform: translateX(-50%) translateY(0); }
    .toast.error { color: var(--danger); border-color: #3a1a1a; }

    /* â”€â”€ Scrollbar â”€â”€ */
    ::-webkit-scrollbar { width: 3px; }
    ::-webkit-scrollbar-track { background: var(--bg); }
    ::-webkit-scrollbar-thumb { background: #2a2a2a; border-radius: 2px; }

    /* â”€â”€ Install Banner â”€â”€ */
    .install-banner {
      background: #111; border: 1px solid #252525; border-radius: 10px;
      padding: 14px 16px; display: flex; align-items: center; justify-content: space-between;
      gap: 12px; margin-bottom: 20px;
    }
    .install-text { font-size: 12px; color: var(--muted); line-height: 1.5; }
    .install-btn {
      background: var(--accent); color: #0a0a0a; border: none; border-radius: 6px;
      padding: 8px 14px; font-family: var(--font); font-size: 11px;
      font-weight: 600; letter-spacing: 0.06em; cursor: pointer; white-space: nowrap;
    }
  </style>
</head>
<body>

<!-- Header -->
<div class="header">
  <div class="header-label">Weight Tracker</div>
  <div class="header-title">ì²´ì¤‘ <span>ê¸°ë¡</span></div>
</div>

<!-- Tabs -->
<div class="tabs">
  <button class="tab-btn active" onclick="switchTab('home')">í™ˆ</button>
  <button class="tab-btn" onclick="switchTab('add')">ê¸°ë¡í•˜ê¸°</button>
  <button class="tab-btn" onclick="switchTab('history')">ë‚´ì—­</button>
</div>

<!-- HOME TAB -->
<div id="tab-home" class="page active">

  <div id="install-banner" class="install-banner" style="display:none;">
    <div class="install-text">ğŸ“² í™ˆ í™”ë©´ì— ì¶”ê°€í•˜ë©´<br>ì•±ì²˜ëŸ¼ ì‚¬ìš©í•  ìˆ˜ ìˆì–´ìš”</div>
    <button class="install-btn" onclick="installApp()">í™ˆì— ì¶”ê°€</button>
  </div>

  <div class="section">
    <div class="section-label">Overview</div>
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-lbl">í˜„ì¬ ì²´ì¤‘</div>
        <div class="stat-val" id="stat-current">â€”</div>
      </div>
      <div class="stat-card">
        <div class="stat-lbl">ì´ ë³€í™”ëŸ‰</div>
        <div class="stat-val gray" id="stat-change">â€”</div>
      </div>
      <div class="stat-card">
        <div class="stat-lbl">ìµœì € ì²´ì¤‘</div>
        <div class="stat-val green" id="stat-min">â€”</div>
      </div>
      <div class="stat-card">
        <div class="stat-lbl">ê¸°ë¡ íšŸìˆ˜</div>
        <div class="stat-val" id="stat-count">0<span class="stat-unit">íšŒ</span></div>
      </div>
    </div>
  </div>

  <div class="section">
    <div class="section-label" id="chart-label">ë³€í™” ì¶”ì´</div>
    <div class="chart-wrap">
      <div class="chart-empty" id="chart-empty">ê¸°ë¡ì´ 2ê°œ ì´ìƒì´ë©´<br>ê·¸ë˜í”„ê°€ ë‚˜íƒ€ë‚˜ìš”</div>
      <svg class="chart" id="chart-svg" style="display:none;" viewBox="0 0 560 180"></svg>
      <div class="tooltip-box" id="tooltip">
        <div class="tooltip-date" id="tt-date"></div>
        <div class="tooltip-weight" id="tt-weight"></div>
        <div id="tt-note" style="font-size:10px;color:#444;margin-top:2px;"></div>
      </div>
    </div>
  </div>
</div>

<!-- ADD TAB -->
<div id="tab-add" class="page">
  <div class="section-label" style="margin-bottom:16px;">ìƒˆ ì²´ì¤‘ ê¸°ë¡</div>
  <div class="form-row">
    <div class="form-group">
      <div class="form-label">ë‚ ì§œ</div>
      <input type="date" id="input-date" />
    </div>
    <div class="form-group">
      <div class="form-label">ì²´ì¤‘ (kg)</div>
      <input type="number" id="input-weight" step="0.1" min="20" max="300" placeholder="00.0" />
    </div>
  </div>
  <input type="text" class="note-input" id="input-note" placeholder="ë©”ëª¨ (ì„ íƒì‚¬í•­)" maxlength="60" />
  <button class="add-btn" onclick="addEntry()">ê¸°ë¡í•˜ê¸°</button>
</div>

<!-- HISTORY TAB -->
<div id="tab-history" class="page">
  <div class="section-label" id="history-label">ê¸°ë¡ ë‚´ì—­</div>
  <div id="history-list"></div>
</div>

<!-- Toast -->
<div class="toast" id="toast"></div>

<script>
  // â”€â”€ State â”€â”€
  let entries = JSON.parse(localStorage.getItem('wt-entries') || '[]');
  let deferredPrompt = null;
  let deletePending = null;

  // â”€â”€ PWA Install â”€â”€
  window.addEventListener('beforeinstallprompt', (e) => {
    e.preventDefault();
    deferredPrompt = e;
    document.getElementById('install-banner').style.display = 'flex';
  });
  window.addEventListener('appinstalled', () => {
    document.getElementById('install-banner').style.display = 'none';
    deferredPrompt = null;
  });
  async function installApp() {
    if (!deferredPrompt) return;
    deferredPrompt.prompt();
    const { outcome } = await deferredPrompt.userChoice;
    deferredPrompt = null;
    document.getElementById('install-banner').style.display = 'none';
  }

  // â”€â”€ Init â”€â”€
  document.getElementById('input-date').value = getTodayStr();
  renderAll();

  // â”€â”€ Tabs â”€â”€
  function switchTab(tab) {
    document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
    document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
    document.getElementById('tab-' + tab).classList.add('active');
    event.currentTarget.classList.add('active');
    deletePending = null;
    if (tab === 'history') renderHistory();
  }

  // â”€â”€ Save â”€â”€
  function save() { localStorage.setItem('wt-entries', JSON.stringify(entries)); }

  // â”€â”€ Add Entry â”€â”€
  function addEntry() {
    const date = document.getElementById('input-date').value;
    const wStr = document.getElementById('input-weight').value;
    const note = document.getElementById('input-note').value.trim();
    const w = parseFloat(wStr);
    if (!wStr || isNaN(w) || w < 20 || w > 300) { showToast('ì˜¬ë°”ë¥¸ ì²´ì¤‘ì„ ì…ë ¥í•´ì£¼ì„¸ìš” (20~300kg)', true); return; }
    if (!date) { showToast('ë‚ ì§œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”', true); return; }
    const entry = { id: Date.now(), date, weight: Math.round(w * 10) / 10, note };
    entries = [...entries.filter(e => e.date !== date), entry].sort((a, b) => a.date.localeCompare(b.date));
    save();
    document.getElementById('input-weight').value = '';
    document.getElementById('input-note').value = '';
    document.getElementById('input-date').value = getTodayStr();
    renderAll();
    showToast('ê¸°ë¡ë˜ì—ˆì–´ìš” âœ“');
    // Switch to home
    document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
    document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
    document.getElementById('tab-home').classList.add('active');
    document.querySelector('.tab-btn').classList.add('active');
  }

  // â”€â”€ Delete â”€â”€
  function requestDelete(id) {
    deletePending = id;
    renderHistory();
  }
  function cancelDelete() { deletePending = null; renderHistory(); }
  function confirmDelete(id) {
    entries = entries.filter(e => e.id !== id);
    save(); deletePending = null;
    renderAll(); renderHistory();
    showToast('ì‚­ì œë˜ì—ˆì–´ìš”');
  }

  // â”€â”€ Render All â”€â”€
  function renderAll() { renderStats(); renderChart(); }

  // â”€â”€ Stats â”€â”€
  function renderStats() {
    const sorted = [...entries].sort((a, b) => a.date.localeCompare(b.date));
    const latest = sorted[sorted.length - 1];
    const first = sorted[0];
    const minW = sorted.length ? Math.min(...sorted.map(e => e.weight)) : null;
    const change = (latest && first && sorted.length > 1) ? latest.weight - first.weight : null;

    const el = id => document.getElementById(id);
    el('stat-current').innerHTML = latest ? `${latest.weight}<span class="stat-unit">kg</span>` : 'â€”';
    if (change !== null) {
      const cls = change < 0 ? 'green' : change > 0 ? 'red' : '';
      el('stat-change').className = `stat-val ${cls}`;
      el('stat-change').innerHTML = `${change > 0 ? '+' : ''}${change.toFixed(1)}<span class="stat-unit">kg</span>`;
    } else {
      el('stat-change').className = 'stat-val gray';
      el('stat-change').innerHTML = 'â€”';
    }
    el('stat-min').innerHTML = minW ? `${minW}<span class="stat-unit">kg</span>` : 'â€”';
    el('stat-count').innerHTML = `${entries.length}<span class="stat-unit">íšŒ</span>`;
  }

  // â”€â”€ Chart â”€â”€
  function renderChart() {
    const sorted = [...entries].sort((a, b) => a.date.localeCompare(b.date));
    const data = sorted.slice(-30);
    const svg = document.getElementById('chart-svg');
    const empty = document.getElementById('chart-empty');
    const lbl = document.getElementById('chart-label');

    if (data.length < 2) { svg.style.display = 'none'; empty.style.display = 'block'; return; }
    svg.style.display = 'block'; empty.style.display = 'none';
    lbl.textContent = `ìµœê·¼ ${data.length}íšŒ ì¶”ì´`;

    const W = 560, H = 180, pad = { t: 16, b: 36, l: 44, r: 12 };
    const iW = W - pad.l - pad.r, iH = H - pad.t - pad.b;
    const ws = data.map(e => e.weight);
    const minV = Math.min(...ws) - 1, maxV = Math.max(...ws) + 1;
    const xStep = iW / (data.length - 1);

    const pts = data.map((e, i) => ({
      x: pad.l + i * xStep,
      y: pad.t + iH - ((e.weight - minV) / (maxV - minV)) * iH,
      entry: e
    }));

    const linePath = pts.map((p, i) => `${i === 0 ? 'M' : 'L'} ${p.x.toFixed(1)} ${p.y.toFixed(1)}`).join(' ');
    const areaPath = `M ${pts[0].x} ${pad.t + iH} ` + pts.map(p => `L ${p.x.toFixed(1)} ${p.y.toFixed(1)}`).join(' ') + ` L ${pts[pts.length - 1].x} ${pad.t + iH} Z`;

    // Y labels
    const yLabels = [0, 0.25, 0.5, 0.75, 1].map(t => ({
      val: (minV + (maxV - minV) * t).toFixed(1),
      y: pad.t + iH - t * iH
    }));
    // X labels
    const xLabels = data.map((e, i) => {
      const show = data.length <= 8 || i % Math.ceil(data.length / 7) === 0 || i === data.length - 1;
      return show ? { x: pts[i].x, label: fmtShort(e.date) } : null;
    }).filter(Boolean);

    svg.innerHTML = `
      <defs>
        <linearGradient id="g1" x1="0" y1="0" x2="0" y2="1">
          <stop offset="0%" stop-color="#7fff7f" stop-opacity="0.14"/>
          <stop offset="100%" stop-color="#7fff7f" stop-opacity="0"/>
        </linearGradient>
      </defs>
      ${yLabels.map(l => `
        <line x1="${pad.l}" y1="${l.y.toFixed(1)}" x2="${W - pad.r}" y2="${l.y.toFixed(1)}" stroke="#1e1e1e" stroke-width="1"/>
        <text x="${pad.l - 6}" y="${(l.y + 4).toFixed(1)}" text-anchor="end" font-size="10" fill="#333" font-family="monospace">${l.val}</text>
      `).join('')}
      ${xLabels.map(l => `<text x="${l.x.toFixed(1)}" y="${H - 8}" text-anchor="middle" font-size="9" fill="#333" font-family="monospace">${l.label}</text>`).join('')}
      <path d="${areaPath}" fill="url(#g1)"/>
      <path d="${linePath}" fill="none" stroke="#7fff7f" stroke-width="1.8" stroke-linejoin="round" stroke-linecap="round"/>
      ${pts.map((p, i) => `<circle cx="${p.x.toFixed(1)}" cy="${p.y.toFixed(1)}" r="4" fill="#111" stroke="#7fff7f" stroke-width="1.8" data-i="${i}" class="chart-pt" style="cursor:pointer;"/>`).join('')}
    `;

    // Tooltip events
    svg.querySelectorAll('.chart-pt').forEach(c => {
      c.addEventListener('mouseenter', (ev) => showTT(ev, pts, data, W, H, pad));
      c.addEventListener('touchstart', (ev) => { ev.preventDefault(); showTT(ev.touches[0], pts, data, W, H, pad); }, { passive: false });
      c.addEventListener('mouseleave', () => { document.getElementById('tooltip').style.display = 'none'; });
      c.addEventListener('touchend', () => setTimeout(() => { document.getElementById('tooltip').style.display = 'none'; }, 1200));
    });
  }

  function showTT(ev, pts, data, W, H, pad) {
    const target = ev.currentTarget || ev.target;
    const i = parseInt(target?.dataset?.i ?? (ev.currentTarget?.dataset?.i ?? 0));
    const p = pts[i], e = data[i];
    const wrap = document.querySelector('.chart-wrap');
    const rect = wrap.getBoundingClientRect();
    const svgEl = document.getElementById('chart-svg');
    const svgRect = svgEl.getBoundingClientRect();
    const scaleX = svgRect.width / W;
    const scaleY = svgRect.height / H;
    const tt = document.getElementById('tooltip');
    document.getElementById('tt-date').textContent = fmtFull(e.date);
    document.getElementById('tt-weight').textContent = `${e.weight} kg`;
    document.getElementById('tt-note').textContent = e.note || '';
    tt.style.display = 'block';
    const ttW = tt.offsetWidth;
    let left = svgRect.left - rect.left + p.x * scaleX - ttW / 2;
    let top = svgRect.top - rect.top + p.y * scaleY - tt.offsetHeight - 10;
    left = Math.max(4, Math.min(left, rect.width - ttW - 4));
    if (top < 2) top = svgRect.top - rect.top + p.y * scaleY + 14;
    tt.style.left = left + 'px';
    tt.style.top = top + 'px';
  }

  // â”€â”€ History â”€â”€
  function renderHistory() {
    const sorted = [...entries].sort((a, b) => b.date.localeCompare(a.date));
    const lbl = document.getElementById('history-label');
    if (lbl) lbl.textContent = `ê¸°ë¡ ë‚´ì—­ (${entries.length})`;
    const list = document.getElementById('history-list');
    if (!entries.length) {
      list.innerHTML = '<div class="empty-state">ì•„ì§ ê¸°ë¡ì´ ì—†ì–´ìš”.<br>ê¸°ë¡í•˜ê¸° íƒ­ì—ì„œ ì¶”ê°€í•´ë³´ì„¸ìš”!</div>';
      return;
    }
    // For delta: need ascending order
    const asc = [...entries].sort((a, b) => a.date.localeCompare(b.date));
    list.innerHTML = sorted.map((e) => {
      const idx = asc.findIndex(x => x.id === e.id);
      const prev = asc[idx - 1];
      const delta = prev ? e.weight - prev.weight : null;
      const deltaTxt = delta !== null ? `<span class="hist-delta ${delta < 0 ? 'green' : delta > 0 ? 'red' : 'gray'}">${delta > 0 ? '+' : ''}${delta.toFixed(1)}</span>` : '';
      const noteEl = e.note ? `<div class="hist-note">${e.note}</div>` : '';
      const actions = deletePending === e.id
        ? `<div class="del-actions">
             <button class="del-btn del-confirm" onclick="confirmDelete(${e.id})">ì‚­ì œ</button>
             <button class="del-btn cancel-btn" onclick="cancelDelete()">ì·¨ì†Œ</button>
           </div>`
        : `<button class="del-btn" onclick="requestDelete(${e.id})">ì‚­ì œ</button>`;
      return `<div class="history-item">
        <div>
          <div class="hist-date">${fmtFull(e.date)}</div>
          <div><span class="hist-weight">${e.weight}<span class="hist-unit"> kg</span></span>${deltaTxt}</div>
          ${noteEl}
        </div>
        ${actions}
      </div>`;
    }).join('');
  }

  // â”€â”€ Toast â”€â”€
  function showToast(msg, isErr = false) {
    const t = document.getElementById('toast');
    t.textContent = msg;
    t.className = 'toast' + (isErr ? ' error' : '');
    t.classList.add('show');
    clearTimeout(t._timer);
    t._timer = setTimeout(() => t.classList.remove('show'), 2400);
  }

  // â”€â”€ Helpers â”€â”€
  function getTodayStr() { return new Date().toISOString().split('T')[0]; }
  function fmtShort(d) { const dt = new Date(d + 'T00:00:00'); return dt.toLocaleDateString('ko-KR', { month: 'numeric', day: 'numeric' }); }
  function fmtFull(d) { const dt = new Date(d + 'T00:00:00'); return dt.toLocaleDateString('ko-KR', { year: 'numeric', month: 'long', day: 'numeric' }); }

  // â”€â”€ Service Worker â”€â”€
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('sw.js').catch(() => {});
  }
</script>
</body>
</html>
